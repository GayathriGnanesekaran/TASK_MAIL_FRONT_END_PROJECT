<!-- task-grid.component.html -->
<!-- <div class="mb-2 d-flex align-items-center gap-2">
  <span class="add-task-label">Add Task</span>
  <button type="button" class="add-row-btn" (click)="addTaskRow()">
    <i class="fa fa-plus"></i>
  </button>
</div> -->

  <form [formGroup]="taskForm">
    <div class="table-responsive table-container shadow-sm">
      <table class="table table-bordered table-sm align-middle small-grid-font">
        <!-- <table class="table table-bordered table-sm table-smaller align-middle"></table> -->
        <thead class="label-color">
          <tr>
            <th>Select</th>
            <th>S.No</th>
            <th>Project</th>
            <th>Sprint</th>
            <th>Task Name *</th>
            <th>Type</th>
            <th>SOW/Issue No</th>
            <th>Is Billable</th>
            <th>Billing Type</th>
            <th>Res. Name</th>
            <th>Team</th>
            <th>Est. Start Dt</th>
            <th>Est. End Dt</th>
            <th>Est. Hours</th>
            <th>Act. Start Dt</th>
            <th>Act. End Dt</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Act. Hours</th>
            <th>%</th>
            <th>Status</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody formArrayName="tasks">
          <tr *ngFor="let task of tasks.controls; let i = index">
            <td><input type="checkbox" formControlName="selected" /></td>
            <td><input type="text" [value]="i+1" readonly class="form-control-plaintext" /></td>
            <td>
              <select formControlName="project" class="form-select form-select-sm project-box">
                <option value="">--Select--</option>
                <option *ngFor="let proj of projectOptions" [value]="proj">{{ proj }}</option>
              </select>
            </td>
            <td><input type="text" formControlName="sprint" /></td>
            <td><input type="text" formControlName="taskName" required /></td>
            <td>
              <select formControlName="type">
                <option value="">--Select--</option>
                <option *ngFor="let type of typeOptions" [value]="type">{{ type }}</option>
              </select>
            </td>
            <td><input type="text" formControlName="sowIssueNo" /></td>
            <td>
              <select formControlName="isBillable">
                <option value="">--Select--</option>
                <option *ngFor="let opt of isBillableOptions" [value]="opt">{{ opt }}</option>
              </select>
            </td>
            <td>
              <select formControlName="billingType">
                <option value="">--Select--</option>
                <option *ngFor="let bill of billingTypeOptions" [value]="bill">{{ bill }}</option>
              </select>
            </td>
            <td><input type="text" formControlName="resName" /></td>
            <td><input type="text" formControlName="team" /></td>  
            <td><input type="date" formControlName="estStartDate" /></td>
            <td><input type="date" formControlName="estEndDate" /></td>
            <td><input type="text" formControlName="estHours" /></td>
            <td><input type="date" formControlName="actStartDate" /></td>
            <td><input type="date" formControlName="actEndDate" /></td>
            <td><input type="time" formControlName="startTime" /></td>
            <td><input type="time" formControlName="endTime" /></td>
            <td><input type="text" formControlName="actHours" /></td>
            <td><input type="text" formControlName="percentage" /></td>
            <td><input type="text" formControlName="status" /></td>
            <td><input type="text" formControlName="comments" /></td>
            <!-- <td><button type="submit" (click)="onsubmit()" style="border: none;"><i class="fa-solid fa-floppy-disk"></i></button></td> -->
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Task Form -->
    <form [formGroup]="taskForm">
      <div class="table-responsive table-container">
        <table class="table table-bordered table-sm align-middle small-grid-font mb-0">
          <thead class="label-color">
            <tr>
              <th>S.No</th>
              <th>Project</th>
              <th>Sprint</th>
              <th>Task Name *</th>
              <th>Type</th>
              <th>SOW/Issue No</th>
              <th>Is Billable</th>
              <th>Billing Type</th>
              <th>Res. Name</th>
              <th>Team</th>
              <th>Est. Start Dt</th>
              <th>Est. End Dt</th>
              <th>Est. Hours</th>
              <th>Act. Start Dt</th>
              <th>Act. End Dt</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Act. Hours</th>
              <th>%</th>
              <th>Status</th>
              <th>Comments</th>
            </tr>
          </thead>
          <tbody formArrayName="tasks">
            <tr *ngFor="let task of tasks.controls; let i = index" [formGroupName]="i">
              <td><input type="text" [value]="i+1" readonly class="form-control-plaintext" /></td>
              <td>
                <select formControlName="project" class="form-select form-select-sm project-box">
                  <option value="">--Select--</option>
                  <option *ngFor="let proj of projectOptions" [value]="proj">{{ proj }}</option>
                </select>
              </td>
              <td><input type="text" formControlName="sprint" /></td>
              <td><input type="text" formControlName="taskName" required /></td>
              <td>
                <select formControlName="type">
                  <option value="">--Select--</option>
                  <option *ngFor="let type of typeOptions" [value]="type">{{ type }}</option>
                </select>
              </td>
              <td><input type="text" formControlName="sowIssueNo" /></td>
              <td>
                <select formControlName="isBillable">
                  <option value="">--Select--</option>
                  <option *ngFor="let opt of isBillableOptions" [value]="opt">{{ opt }}</option>
                </select>
              </td>
              <td>
                <select formControlName="billingType">
                  <option value="">--Select--</option>
                  <option *ngFor="let bill of billingTypeOptions" [value]="bill">{{ bill }}</option>
                </select>
              </td>
              <td><input type="text" formControlName="resName" /></td>
              <td><input type="text" formControlName="team" /></td>
              <td><input type="date" formControlName="estStartDate" /></td>
              <td><input type="date" formControlName="estEndDate" /></td>
              <td><input type="text" formControlName="estHours" /></td>
              <td><input type="date" formControlName="actStartDate" /></td>
              <td><input type="date" formControlName="actEndDate" /></td>
              <td><input type="time" formControlName="startTime" /></td>
              <td><input type="time" formControlName="endTime" /></td>
              <td><input type="text" formControlName="actHours" /></td>
              <td><input type="text" formControlName="percentage" /></td>
              <td><input type="text" formControlName="status" /></td>
              <td><input type="text" formControlName="comments" /></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Error Message -->
      <div *ngIf="showError" class="text-danger mt-2 px-2">Please fill required fields for the selected rows before saving.</div>
    </form>
  </div>
</div>
